# Changelog

All notable changes to the Databricks DDL Generator will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [2.1.0] - 2025-01-12

### Added
- **F-8: Smart Foreign Key Validation** - Intelligent validation of FK columns against actual primary keys
- **F-9: Unique Constraint Naming** - Attribute-based naming to prevent `DELTA_CONSTRAINT_ALREADY_EXISTS` errors
- **Enhanced Data Type Mapping (F-1, F-2)** - Comprehensive type mapping with 25+ conversions including critical BIT→BOOLEAN
- **Inline Primary Key Constraints (F-3)** - Modern DDL syntax with PKs inline in CREATE TABLE statements
- **Identity Column Support (F-4)** - Auto-detection of identity indicators with proper GENERATED BY DEFAULT AS IDENTITY syntax
- **Fully Qualified Names (F-5)** - Catalog and schema support with live preview and automatic prefixing
- **Custom Constraint Names (F-6)** - Override default naming with session persistence
- **Professional Output Formatting (F-7)** - Column alignment, consistent spacing, and enhanced relationship format
- Comprehensive test suite (`test_core_functions.py`) validating all core functionality
- Detailed improvements documentation (`IMPROVEMENTS_SUMMARY.md`)

### Fixed
- **Duplicate constraint names** causing `[DELTA_CONSTRAINT_ALREADY_EXISTS]` errors in Databricks
- **Identifier sanitization** now converts dots to underscores (e.g., `crm.sales` → `crm_sales`) to prevent `[SCHEMA_NOT_FOUND]` errors
- **Foreign key validation errors** with smart validation preventing `[FOREIGN_KEY_COLUMN_MISMATCH]` errors
- **Composite foreign key handling** - automatically converts invalid composite FKs to valid single-column FKs

### Changed
- **Enhanced User Interface** with organized sections, better tooltips, and visual feedback
- **Constraint naming format** now includes attribute names: `fk_{target_table}_{target_column}_{source_table}`
- **Error handling** with clear messages and detailed explanations for skipped relationships
- **Data type reference** with expandable mapping table for user guidance

### Technical Improvements
- Modular function architecture with comprehensive type hints
- Enhanced `DATABRICKS_TYPE_MAPPING` dictionary with regex pattern matching
- Smart validation logic for FK relationships
- Professional column alignment with dynamic width calculation
- Session-based storage for user preferences

## [2.0.0] - 2024-12-15

### Added
- Initial comprehensive feature set based on customer feedback
- Basic data type mapping
- Primary and foreign key constraint support
- Streamlit web interface
- API integration with Ellie.ai
- Sample data and basic testing

### Features
- JSON parsing for Ellie.ai physical data models
- DDL generation for Databricks
- Basic identifier sanitization
- Delta table format support
- Table and column comments

## [1.0.0] - 2024-11-01

### Added
- Initial release
- Basic DDL generation functionality
- Simple JSON input support
- Core Databricks compatibility

---

## Customer Feedback Implementation

All features F-1 through F-9 were implemented based on direct customer feedback and real-world usage scenarios:

- **F-1**: Enhanced Data Type Mapping Engine
- **F-2**: "Handle Non-Compatible Data Types" Toggle  
- **F-3**: Inline Primary Key Constraints
- **F-4**: Identity Column Support
- **F-5**: Fully Qualified Names
- **F-6**: Relationship & Constraint Naming
- **F-7**: Output Formatting & Syntax Highlighting
- **F-8**: Foreign Key Validation (Additional Feature)
- **F-9**: Unique Foreign Key Constraint Names (Bug Fix)

## Production Readiness

Version 2.1.0 represents a production-ready release that:
- ✅ Generates DDL that executes in Databricks without manual editing
- ✅ Addresses all customer concerns and requirements
- ✅ Provides comprehensive error prevention and validation
- ✅ Offers professional user experience with organized interface
- ✅ Includes comprehensive testing and documentation 